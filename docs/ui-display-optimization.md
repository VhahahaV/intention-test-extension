# Webview 展示优化说明

## 背景
- Webview 默认背景与 VS Code 深色主题冲突，导致生成内容呈现黑底白字且层次不清。
- 消息卡片、空状态与代码块缺乏视觉分隔，阅读长对话较吃力。
- 代码操作按钮位置固定在代码块外缘，黑底背景下几乎看不见。

## 本次优化
1. **主题对齐**：使用 VS Code 暴露的 `--vscode-*` 变量统一设置 body、字体与文本颜色，确保在明/暗主题下都保持可读性。
2. **容器与留白**：将聊天区域限制在 960px 宽度内并添加圆角、阴影与统一内边距，空状态使用虚线框提示等待态。
3. **消息卡片**：卡片化每条消息，加入左侧色条区分用户/助手来源，调整标题排版与行距，让段落更加疏朗。
4. **代码可读性**：为 `pre` 与行内 `code` 设置柔和底色、边框与滚动处理，同时重新布置 “Open” / “Restart” 按钮以在浅色和深色主题下可见。
5. **细节交互**：优化 typing 动画、按钮 hover、列表缩进等细节，让整体观感更接近现代聊天界面。

## 后续建议
- 统一移除 `index.html` 中的内联脚本，避免与 `index.js` 重复执行造成状态错乱。
- 引入主题自适应的 Highlight.js 样式（或自定义样式），让代码高亮与 VS Code 主题完全一致。
- 增加顶部工具栏（如刷新、清空、导出对话），进一步提升使用效率。

## 第二阶段优化
- **脚本解耦**：完全移除 `index.html` 内联脚本，只保留 `index.js` 作为单一入口，防止事件监听与状态重复注册。
- **消息管线重写**：`web/index.js` 现使用结构化的 `addMessage/completeTypingAnimation`，修复 `sendMessage/raw/liveContentContainers` 等未定义引用，同时在 `clear` 指令时恢复空状态提示。
- **代码块增强**：统一在 JS 层为 `pre code` 与行内 `code` 运行 `hljs.highlightElement`，并封装按钮装饰逻辑，避免重复创建监听器。
- **交互细节**：自动滚动逻辑尊重用户最近 3 秒的滚动/鼠标操作；删除打字动画时同步移除标题，保持 DOM 干净。

## 第三阶段优化
- **统一高亮主题**：摒弃 Highlight.js 默认样式，转而使用 VS Code 主题变量自定义 `.hljs` 配色，确保深浅主题都与编辑器一致。
- **全局工具栏**：在 `index.html` 中新增顶部工具栏，提供“一键清空”“跳到最新”操作，配合新的 `toolbar-actions` 样式提升可见性与触达率。
- **交互指令闭环**：`index.js` 新增 `requestClearConversation`，并让扩展端 (`sidebarView.ts`) 响应 `clear-chat` 消息，保证 Webview 与扩展状态一致。
- **可维护滚动控制**：封装 `scrollToLatest/setConversationLength`，让自动滚动、手动跳转、清空对话都可复用同一逻辑，避免 DOM 失衡。
